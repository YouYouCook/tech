<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="medicine_cg" >
<typeAlias alias="medicineCgBO" type="cn.krt.zbcg.commons.bo.system.MedicineCgBO"/>
  <resultMap id="CineCgResult" class="cn.krt.zbcg.commons.bo.system.MedicineCgBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
    <result column="cg_id" property="cgId" jdbcType="INTEGER" />
    <result column="medicine_id" property="medicineId" jdbcType="INTEGER" />
    <result column="cg_qty" property="cgQty" jdbcType="INTEGER" />
    <result column="reach_date" property="reachDate" jdbcType="VARCHAR" />
    <result column="cg_state" property="cgState" jdbcType="CHAR" />

    <result column="end_date" property="endDate" jdbcType="VARCHAR" />
    <result column="begin_date" property="beginDate" jdbcType="VARCHAR" />
    <result column="end_date" property="endDate" jdbcType="VARCHAR" />
    <result property="medicineBO" column="medicine_id" select="medicine.selectById"/>
    <!-- 采购系统第4次修改 -->
    <result column="agbj" property="agbj" jdbcType="DOUBLE" />
    <result column="bzbj" property="bzbj" jdbcType="DOUBLE" />
    <result column="lscfl" property="lscfl" jdbcType="DOUBLE" />
  </resultMap>
 
  
  
  <select id="selectByPrimaryKey" resultMap="CineCgResult" parameterClass="cn.krt.zbcg.commons.bo.system.MedicineCgBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
    select cg_id, medicine_id, cg_qty, reach_date, cg_state, begin_date,end_date,remark,agbj,bzbj,lscfl
    from medicine_cg
    where cg_id = #cgId#
  </select>
  
  <select id="selectById" resultMap="CineCgResult" parameterClass="int" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
    select cg_id, medicine_id, cg_qty, reach_date, cg_state, begin_date,end_date,remark,agbj,bzbj,lscfl
    from medicine_cg
    where cg_id = #cgId#
  </select>
  
  <select id="selectByCgDate" resultMap="CineCgResult" parameterClass="String" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
    select cg_id, c.medicine_id, cg_qty, reach_date, cg_state, begin_date,end_date,c.remark,agbj,bzbj,lscfl
    from medicine_cg c
    where 1 = 1 
    <isNotNull property="cgDate">
				<isNotEmpty  property="cgDate">
				and subString(cg_date,1,7)=subString(#cgDate#,1,7)
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="medicineId">
				<isNotEmpty  property="medicineId">
				and medicine_id = medicineId
				</isNotEmpty>
			</isNotNull>
  </select>
  
  <select id="selectAll" resultMap="CineCgResult" parameterClass="java.util.Map" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
     SELECT * FROM ( SELECT  c.* from ( 
     select cg_id, c.medicine_id, cg_qty, reach_date, cg_state, begin_date,end_date,c.remark,agbj,bzbj,lscfl
    from medicine_cg c
    where 1 = 1 
   
    	<isNotNull property="beginDate">
			<isNotEmpty  property="beginDate">
		 <![CDATA[	and begin_date >= '$beginDate$' ]]> 
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="endDate">
			<isNotEmpty  property="endDate">
		 <![CDATA[	and end_date <= '$endDate$'  ]]> 
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="medicineId">
				<isNotEmpty  property="medicineId">
				and medicine_id = #medicineId#
				</isNotEmpty>
			</isNotNull>
			
     ) c) a order by cg_id desc
      LIMIT  $ibegin$, 10
  </select>
  <select id="selectAllOfCount" resultClass="java.lang.String" parameterClass="java.util.Map" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
     SELECT count(0) FROM ( SELECT  c.* from ( 
     select cg_id, c.medicine_id, cg_qty, reach_date, cg_state, begin_date,end_date,c.remark,agbj,bzbj,lscfl
    from medicine_cg c
    where 1 = 1 
    
    	<isNotNull property="beginDate">
			<isNotEmpty  property="beginDate">
		 <![CDATA[	and begin_date >= '$beginDate$' ]]> 
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="endDate">
			<isNotEmpty  property="endDate">
			<![CDATA[ and end_date <= '$endDate$' ]]> 
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="medicineId">
				<isNotEmpty  property="medicineId">
				and medicine_id = #medicineId#
				</isNotEmpty>
			</isNotNull>
			
     ) c) a  
  </select>
  <delete id="deleteByPrimaryKey" parameterClass="cn.krt.zbcg.commons.bo.system.MedicineCgBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
    delete from medicine_cg
    where cg_id = #cgId#
  </delete>
  <insert id="insert" parameterClass="cn.krt.zbcg.commons.bo.system.MedicineCgBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
    insert into medicine_cg (cg_id, medicine_id, cg_qty, reach_date, cg_state, begin_date,end_date,agbj,bzbj,lscfl)
    values (#cgId#, #medicineId#, #cgQty#, #reachDate#, #cgState#, #beginDate#,#endDate#,#agbj#,#bzbj#,#lscfl#)
  </insert>
  <update id="updateByPrimaryKey" parameterClass="cn.krt.zbcg.commons.bo.system.MedicineCgBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
    update medicine_cg
    set 
      cg_qty = #cgQty#,
      reach_date = #reachDate#,
      remark = #remark#
    where cg_id = #cgId#
  </update>
  
  <insert id="addCG" parameterClass="java.util.Map" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.current_date()  
    -->
    insert into medicine_cg (medicine_id, cg_qty, reach_date, cg_state, begin_date,end_date,remark,agbj,bzbj,lscfl)
    	select medicine_id,#cgQty#,#reachDate#,'1',#beginDate#,#endDate#,#remark#,#agbj#,#bzbj#,#lscfl#
    		from medicine where medicine_id = #medicineId#
  </insert>
  
  <delete id="deleteZb" parameterClass="cn.krt.zbcg.commons.bo.system.MedicineCgBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
    delete from medicine_zb
    where jb_id in(select jb_id from medicine_jb where cg_id=#cgId#)
  </delete>
  
  <delete id="deleteJb" parameterClass="cn.krt.zbcg.commons.bo.system.MedicineCgBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Thu Sep 29 10:48:02 CST 2011.
    -->
    delete from medicine_jb where cg_id=#cgId#
    
  </delete>
  
   <update id="updateCgJB" parameterClass="java.util.Map" >
    update medicine_cg
    set 
      end_date = substring(current_date(),1,10)
    where cg_id = #cgId#
  </update>
  <!-- 采购系统第4次修改 -->
   <select id="selectAllList" resultMap="CineCgResult" parameterClass="cn.krt.zbcg.commons.bo.system.MedicineCgBO" >
    select cg_id, medicine_id, cg_qty, reach_date, cg_state, begin_date,end_date,remark,agbj,bzbj,lscfl
    from medicine_cg
  </select>
   <!--采购系统第4次修改 投标起始日下发短信  -->
  <select id="startTender"  resultClass="java.util.HashMap" remapResults="true">
    SELECT  cg_id, medicine_id, cg_qty, reach_date, cg_state, begin_date,end_date,remark,agbj,bzbj,lscfl
    from 	medicine_cg 
    where  <![CDATA[substring(current_date(),1,10) = begin_date ]]> 
  </select>
  <!--采购系统第4次修改 投标截止日下发短信  -->
  <select id="endTender"  resultClass="java.util.HashMap" remapResults="true">
  	SELECT  cg_id, medicine_id, cg_qty, reach_date, cg_state, begin_date,end_date,remark,agbj,bzbj,lscfl
    from 	medicine_cg 
    where  <![CDATA[substring(current_date(),1,10) = end_date ]]> 
  </select>
</sqlMap>