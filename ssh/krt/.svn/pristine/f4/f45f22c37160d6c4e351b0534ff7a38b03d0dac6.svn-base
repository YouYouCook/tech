<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="SERVICE_B_SERVICE_CONFIG" >
  <resultMap id="ServiceConfigResult" class="cn.id5.idreal_hr.commons.bo.service.ServiceConfigBO" >
    <!--
      原始生成
    -->
    <result column="SC_ID" property="scId" jdbcType="DECIMAL" />
    <result column="EI_ID" property="eiId" jdbcType="DECIMAL" />
    <result column="EI_ENTERPRISE_ID" property="eiEnterpriseId" jdbcType="VARCHAR" />
    <result column="SC_ORDER_ID" property="scOrderId" jdbcType="VARCHAR" />
    <result column="SC_SERVICE_TYPE" property="scServiceType" jdbcType="CHAR" />
    <result column="SC_SERVICE_NAME" property="scServiceName" jdbcType="VARCHAR" />
    <result column="SC_ORDER_AMOUNT" property="scOrderAmount" jdbcType="DECIMAL" />
    <result column="SC_STATUS" property="scStatus" jdbcType="VARCHAR" />
    <result column="SC_START_TIME" property="scStartTime" jdbcType="VARCHAR" />
    <result column="SC_END_TIME" property="scEndTime" jdbcType="VARCHAR" />
    <result column="SC_CREATEUSER" property="scCreateuser" jdbcType="VARCHAR" />
    <result column="CUSTOMER_CODE" property="customerCode" jdbcType="VARCHAR" />
    <result column="SC_CREATETIME" property="scCreatetime" jdbcType="VARCHAR" />
    <result column="SC_MODIFYUSER" property="scModifyuser" jdbcType="VARCHAR" />
    <result column="SC_MODIFYTIME" property="scModifytime" jdbcType="VARCHAR" />
    <result column="SC_EXT1" property="scExt1" jdbcType="VARCHAR" />
    <result column="SC_EXT2" property="scExt2" jdbcType="VARCHAR" />
    <result column="SC_EXT3" property="scExt3" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="OrderResult" class="cn.id5.idreal_hr.commons.bo.service.OrderBO" >
    <!--
      订单查询构建基本单位
    -->
    <result column="SC_ORDER_ID" property="scOrderId" jdbcType="VARCHAR" />
    <!-- 服务类型组，多个服务类型用逗号隔开 -->
    <result column="SC_SERVICE_TYPES" property="scServiceType" jdbcType="VARCHAR" />
    <result column="SC_STATUS" property="scStatus" jdbcType="VARCHAR" />
  </resultMap>
  <select id="selectByPrimaryKey" resultMap="ServiceConfigResult" parameterClass="cn.id5.idreal_hr.commons.bo.service.ServiceConfigBO" >
    select SC_ID, EI_ID, EI_ENTERPRISE_ID, SC_ORDER_ID, SC_SERVICE_TYPE, SC_SERVICE_NAME,
      SC_ORDER_AMOUNT, SC_STATUS, SC_START_TIME, SC_END_TIME, SC_CREATEUSER, CUSTOMER_CODE,
      SC_CREATETIME, SC_MODIFYUSER, SC_MODIFYTIME, SC_EXT1, SC_EXT2, SC_EXT3
    from B_SERVICE_CONFIG
    where SC_ID = #scId#
  </select>
  <select id="selectAll" resultMap="ServiceConfigResult" parameterClass="java.util.Map" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Wed Feb 16 15:20:27 CST 2011.
    -->
     SELECT * FROM ( SELECT ROWNUM AS NUMROW, c.* from ( 
    select SC_ID, EI_ID, EI_ENTERPRISE_ID, SC_ORDER_ID, SC_SERVICE_TYPE, SC_SERVICE_NAME,
      SC_ORDER_AMOUNT, SC_STATUS, SC_START_TIME, SC_END_TIME, SC_CREATEUSER, CUSTOMER_CODE,
      SC_CREATETIME, SC_MODIFYUSER, SC_MODIFYTIME, SC_EXT1, SC_EXT2, SC_EXT3
      from B_SERVICE_CONFIG
     where 1=1
    <dynamic>
	    <isNotNull prepend="AND" property="seatAccount">
		    <isEqual property="seatIsAdmin" compareValue="0">
		     customer_code = (
		     	 select customer_code from c_t_customer where customer_id = (
		     	 		select customer_id from c_t_seat where seat_account = #seatAccount#
		     	 )
		     )
			</isEqual>
		    <isEqual property="seatIsAdmin" compareValue="1">
		     SC_CREATEUSER = #seatAccount#
		    </isEqual>
	    </isNotNull>
	    <isNotNull prepend="AND" property="createUser">
	    	SC_CREATEUSER = #createUser#
	    </isNotNull>
	    <isNotNull prepend="AND" property="customerCode">
	    	CUSTOMER_CODE = #customerCode#
	    </isNotNull>
	    <isNotNull prepend="AND" property="scOrderId">
	    	SC_ORDER_ID = #scOrderId#
	    </isNotNull>
	    <isNotNull prepend="AND" property="scEnterpriseId">
	    	EI_ENTERPRISE_ID = #scEnterpriseId#
	    </isNotNull>
     ) c) 
	    <isNotNull property="ibegin">
     <![CDATA[ WHERE NUMROW >= $ibegin$  AND NUMROW < $iend$  ]]>
	    </isNotNull>
    </dynamic>
  </select>
  <select id="selectAllOfCount" resultClass="java.lang.String" parameterClass="java.util.Map" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Wed Feb 16 15:20:27 CST 2011.
    -->
     SELECT count(1) as ID from ( 
    select SC_ID, EI_ID, EI_ENTERPRISE_ID, SC_ORDER_ID, SC_SERVICE_TYPE, SC_SERVICE_NAME,
      SC_ORDER_AMOUNT, SC_STATUS, SC_START_TIME, SC_END_TIME, SC_CREATEUSER, CUSTOMER_CODE,
      SC_CREATETIME, SC_MODIFYUSER, SC_MODIFYTIME, SC_EXT1, SC_EXT2, SC_EXT3
      from B_SERVICE_CONFIG
     where 1=1
    <dynamic>
	    <isNotNull prepend="AND" property="seatAccount">
		    <isEqual property="seatIsAdmin" compareValue="0">
		     customer_code = (
		     	 select customer_code from c_t_customer where customer_id = (
		     	 		select customer_id from c_t_seat where seat_account = #seatAccount#
		     	 )
		     )
			</isEqual>
		    <isEqual property="seatIsAdmin" compareValue="1">
		     SC_CREATEUSER = #seatAccount#
		    </isEqual>
	    </isNotNull>
	    <isNotNull prepend="AND" property="createUser">
	    	SC_CREATEUSER = #createUser#
	    </isNotNull>
	    <isNotNull prepend="AND" property="customerCode">
	    	CUSTOMER_CODE = #customerCode#
	    </isNotNull>
	    <isNotNull prepend="AND" property="scOrderId">
	    	SC_ORDER_ID = #scOrderId#
	    </isNotNull>
	    <isNotNull prepend="AND" property="scEnterpriseId">
	    	EI_ENTERPRISE_ID = #scEnterpriseId#
	    </isNotNull>
    </dynamic>
     ) 
  </select>
  <!-- 根据企业查询订单列表 -->
  <select id="selectAllForEnterprise" resultMap="OrderResult" parameterClass="java.util.Map" >
    <!--
      查询企业下订单列表
    -->
	 
     SELECT * FROM ( SELECT ROWNUM AS NUMROW, c.* from ( 
    select t.sc_order_id sc_order_id, sc_status, wmsys.wm_concat(t.sc_service_type) sc_service_types
	  from b_service_config t
	 where sc_status != 2
    <dynamic>
	    <isNotNull prepend="AND" property="createUser">
	    	SC_CREATEUSER = #createUser#
	    </isNotNull>
	    <isNotNull prepend="AND" property="customerCode">
	    	CUSTOMER_CODE = #customerCode#
	    </isNotNull>
	    <isNotNull prepend="AND" property="seatAccount">
		    <isEqual property="seatIsAdmin" compareValue="0">
		     t.customer_code = (
		     	 select customer_code from c_t_customer where customer_id = (
		     	 		select customer_id from c_t_seat where seat_account = #seatAccount#
		     	 )
		     )
			</isEqual>
		    <isEqual property="seatIsAdmin" compareValue="1">
		     t.SC_CREATEUSER = #seatAccount#
		    </isEqual>
	    </isNotNull>
	    <isNotNull prepend="AND" property="scEnterpriseId">
	    	t.EI_ENTERPRISE_ID = #scEnterpriseId#
	    </isNotNull>
    </dynamic>
	 group by t.sc_order_id, sc_status
     order by t.sc_order_id desc
     ) c) 
     <![CDATA[ WHERE NUMROW >= $ibegin$  AND NUMROW < $iend$  ]]>
  </select>
  <select id="selectAllOfCountForEnterprise" resultClass="java.lang.String" parameterClass="java.util.Map" >
    <!--
      查询企业下订单列表总数
    -->
     SELECT count(1) as ID from ( 
    select t.sc_order_id sc_order_id, sc_status, wmsys.wm_concat(t.sc_service_type) sc_service_types
	  from b_service_config t
	 where sc_status != 2
    <dynamic>
	    <isNotNull prepend="AND" property="createUser">
	    	SC_CREATEUSER = #createUser#
	    </isNotNull>
	    <isNotNull prepend="AND" property="customerCode">
	    	CUSTOMER_CODE = #customerCode#
	    </isNotNull>
	    <isNotNull prepend="AND" property="seatAccount">
		    <isEqual property="seatIsAdmin" compareValue="0">
		     t.customer_code = (
		     	 select customer_code from c_t_customer where customer_id = (
		     	 		select customer_id from c_t_seat where seat_account = #seatAccount#
		     	 )
		     )
			</isEqual>
		    <isEqual property="seatIsAdmin" compareValue="1">
		     t.SC_CREATEUSER = #seatAccount#
		    </isEqual>
	    </isNotNull>
	    <isNotNull prepend="AND" property="scEnterpriseId">
	    	t.EI_ENTERPRISE_ID = #scEnterpriseId#
	    </isNotNull>
    </dynamic>
	 group by t.sc_order_id, sc_status
     ) 
  </select>
  <delete id="deleteByPrimaryKey" parameterClass="cn.id5.idreal_hr.commons.bo.service.ServiceConfigBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Mon Feb 21 15:38:10 CST 2011.
    -->
    delete from B_SERVICE_CONFIG
    where SC_ID = #scId#
  </delete>
  <insert id="insert" parameterClass="cn.id5.idreal_hr.commons.bo.service.ServiceConfigBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Mon Feb 21 15:38:10 CST 2011.
    -->
    <selectKey resultClass="java.math.BigDecimal" keyProperty="scId" >
      SELECT SEQ_B_SERVICE_CONFIG.NEXTVAL AS ID FROM DUAL
    </selectKey>
    insert into B_SERVICE_CONFIG (SC_ID, EI_ID, EI_ENTERPRISE_ID, SC_ORDER_ID, SC_SERVICE_TYPE,
      SC_SERVICE_NAME, SC_ORDER_AMOUNT, SC_STATUS, SC_START_TIME, SC_END_TIME, SC_CREATEUSER,
      CUSTOMER_CODE, SC_CREATETIME, SC_MODIFYUSER, SC_MODIFYTIME, SC_EXT1, SC_EXT2, SC_EXT3)
    values (#scId#, #eiId#, #eiEnterpriseId#, #scOrderId#, #scServiceType#, #scServiceName#,
      #scOrderAmount#, #scStatus#, #scStartTime#, #scEndTime#, #scCreateuser#, #customerCode#,
      to_char(sysdate,'yyyy-mm-dd hh24:mi:ss'), #scModifyuser#, #scModifytime#, #scExt1#, #scExt2#, #scExt3#)
  </insert>
  <update id="updateByPrimaryKey" parameterClass="cn.id5.idreal_hr.commons.bo.service.ServiceConfigBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Mon Feb 21 15:38:10 CST 2011.
    -->
    update B_SERVICE_CONFIG
    set EI_ID = #eiId#,
      EI_ENTERPRISE_ID = #eiEnterpriseId#,
      SC_ORDER_ID = #scOrderId#,
      SC_SERVICE_TYPE = #scServiceType#,
      SC_SERVICE_NAME = #scServiceName#,
      SC_ORDER_AMOUNT = #scOrderAmount#,
      SC_STATUS = #scStatus#,
      SC_START_TIME = #scStartTime#,
      SC_END_TIME = #scEndTime#,
      SC_MODIFYUSER = #scModifyuser#,
      SC_MODIFYTIME = to_char(sysdate,'yyyy-mm-dd hh24:mi:ss')
    where SC_ID = #scId#
  </update>
  
  <!-- 功能性查询 -->
  <select id="generateOrderId" resultClass="java.lang.String">
    <!-- 订单号生成 -->
	select to_char(sysdate,'yyyymmddhh24miss')||lpad(seq_order_no.nextval,3,'0') from dual
  </select>
  
  <update id="updateStatusByOrderId" parameterClass="java.lang.String" >
    <!--
      确认定稿，修改状态
    -->
    update B_SERVICE_CONFIG
       set SC_STATUS = 1
     where SC_ORDER_ID = #value#
  </update>
  
  <update id="updateByOrderId" parameterClass="java.lang.String" >
    <!--
      标记删除
    -->
    update B_SERVICE_CONFIG
       set SC_STATUS = 2
     where SC_ORDER_ID = #value#
  </update>
  <select id="findOrderByEnterpriseId" resultMap="ServiceConfigResult" parameterClass="cn.id5.idreal_hr.commons.bo.service.ServiceConfigBO" >
  <!-- 根据企业客户id查找订单信息  add by xinjuan-->
    select SC_ID, EI_ID, EI_ENTERPRISE_ID, SC_ORDER_ID, SC_SERVICE_TYPE, SC_SERVICE_NAME,
      SC_ORDER_AMOUNT, SC_STATUS, SC_START_TIME, SC_END_TIME, SC_CREATEUSER, CUSTOMER_CODE,
      SC_CREATETIME, SC_MODIFYUSER, SC_MODIFYTIME, SC_EXT1, SC_EXT2, SC_EXT3
    from B_SERVICE_CONFIG
    where EI_ID = #eiId#
    and  (sc_status = 0 or sc_status = 1)
  </select>
  <select id="findEnterpriseIdByOrderId" resultClass="java.lang.String" parameterClass="java.lang.String" >
  <!-- 根据订单号查找企业客户id  add by xinjuan-->
    select EI_ENTERPRISE_ID
      from B_SERVICE_CONFIG
     where SC_ORDER_ID = #value#
       and rownum=1
  </select>
</sqlMap>