<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="vip_zb" >
  <resultMap id="ZbResult" class="cn.krt.zbcg.commons.bo.system.VipzbBO" >
    <!--
      WARNING - This element is automatically generated by GBOSS-Abator for SSI, do not modify.
      This element was generated on Wed Oct 05 13:16:09 CST 2011.
    -->
    <result column="vipzb_id" property="vipzbId" jdbcType="INTEGER" />
    <result column="customer_id" property="customerId" jdbcType="INTEGER" />
    <result column="medicine_id" property="medicineId" jdbcType="INTEGER" />
    <result column="begin_date" property="beginDate" jdbcType="VARCHAR" />
    <result column="end_date" property="endDate" jdbcType="VARCHAR" />
     <result column="state" property="state" jdbcType="VARCHAR" />
     <result property="medicineBO" column="medicine_id" select="medicine.selectById"/>
     <result property="customerBO" column="customer_id" select="customer.selectById"/>
  </resultMap>
  <select id="selectByPrimaryKey" resultMap="ZbResult" parameterClass="cn.krt.zbcg.commons.bo.system.VipzbBO" >
    select vipzb_id, customer_id, medicine_id, begin_date,end_date,state
    from vip_zb
    where vipzb_id = #vipzbId#
  </select>
  <select id="selectAll" resultMap="ZbResult" parameterClass="java.util.Map" >
     SELECT * FROM ( SELECT ROWNUM AS NUMROW, c.* from ( 
     select vipzb_id, customer_id, medicine_id, begin_date,end_date,state
    from vip_zb
     ) c) 
     <![CDATA[ WHERE NUMROW >= $ibegin$  AND NUMROW < $iend$  ]]>
  </select>
  <select id="selectAllOfCount" resultClass="java.lang.String" parameterClass="java.util.Map" >
     SELECT count(1) as ID from ( 
     select vipzb_id, customer_id, medicine_id, begin_date,end_date,state
    from vip_zb
     ) 
  </select>
  <delete id="deleteByPrimaryKey" parameterClass="cn.krt.zbcg.commons.bo.system.VipzbBO" >
    delete from vip_zb
    where vipzb_id = #vipzbId#
  </delete>
  <insert id="insert" parameterClass="cn.krt.zbcg.commons.bo.system.VipzbBO" >
    insert into vip_zb (vipzb_id, customer_id, medicine_id, begin_date,end_date,state)
    values (#vipzbId#, #customerId#, #medicineId#, #beginDate#,#endDate#,#state#)
  </insert>
  <!-- 占用 -->
  <update id="updateByPrimaryKey" parameterClass="cn.krt.zbcg.commons.bo.system.VipzbBO" >
    update vip_zb set state = '0'  where  medicine_id = #medicineId# and begin_date = #beginDate# and state = '1'
  </update>
   <select id="findZbCustomer" resultMap="ZbResult" parameterClass="java.util.Map" >
    select vipzb_id, customer_id, medicine_id, begin_date,end_date,state
    from vip_zb
    where   state = 1
    <isNotNull property="medicineId">
			<isNotEmpty  property="medicineId">
			and medicine_id=#medicineId#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="beginDate">
			<isNotEmpty  property="beginDate">
			and begin_date=#beginDate#
			</isNotEmpty>
		</isNotNull>
		
  </select>
   <select id="findByMc" resultMap="ZbResult" parameterClass="cn.krt.zbcg.commons.bo.system.VipzbBO" >
    select vipzb_id, customer_id, medicine_id, begin_date,end_date,state
    from vip_zb
    where customer_id = #customerId# and medicine_id = #medicineId# and begin_date = #beginDate#
  </select>
  <update id="updateOne" parameterClass="cn.krt.zbcg.commons.bo.system.VipzbBO" >
    update vip_zb set state = 1  where customer_id = #customerId# and medicine_id = #medicineId# and begin_date = #beginDate#
  </update>
</sqlMap>